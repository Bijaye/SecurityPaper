window.forbesCount||(window.forbesCount=1,function(b){function v(){window.jQuery&&(b=window.jQuery);var a="undefined"!=typeof b,c=function(){var c=a&&b.fn.jquery;if(!c)return{major:0,minor:0};c=c.split("-")[0].split(".");return{major:+c[0],minor:+c[1]}}();!a||1>c.major||1==c.major&&7>c.minor?function(){var a=document.createElement("script"),c=!1,g=document.getElementsByTagName("script")[0],I=function(){!c&&window.jQuery&&(c=!0,b=jQuery.noConflict(!0),b(q))};a.setAttribute("type","text/javascript");a.setAttribute("src","https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js");a.onload=I;a.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||I()};g.parentNode.insertBefore(a,g)}():b(q)}function C(a,c){return Math.floor(Math.random()*(c-a+1))+a}function q(){b("body").hasClass("body_article")&&(O(),b.getScript("//sdk.amazonaws.com/js/aws-sdk-2.0.0-rc13.min.js").done(function(){var a=b.cookie("forbes-stat-uid-ip"),c=b.cookie("forbes-stat-uid")||P();b.cookie("forbes-stat-uid",c,{expires:60,path:"/"});a?new h({uid:c,user_ip:a||""}):n().done(function(a){b.cookie("forbes-stat-uid-ip",a,{expires:1/24/4,path:"/"});new h({uid:c,user_ip:a||""})})}))}function O(){window.XDomainRequest&&b.ajaxTransport(function(a){if(a.crossDomain&&a.async){a.timeout&&(a.xdrTimeout=a.timeout,delete a.timeout);var c;return{send:function(d,e){function g(a,d,g,h){c.onload=c.onerror=c.ontimeout=b.noop;c=void 0;e(a,d,g,h)}c=new window.XDomainRequest;c.onload=function(){g(200,"OK",{text:c.responseText},"Content-Type: "+c.contentType)};c.onerror=function(){g(404,"Not Found")};c.onprogress=function(){};a.xdrTimeout&&(c.ontimeout=function(){g(0,"timeout")},c.timeout=a.xdrTimeout);c.open(a.type,a.url,!0);c.send(a.hasContent&&a.data||null)},abort:function(){c&&(c.onerror=b.noop(),c.abort())}}}});b.extend(b.fn,{livequery:function(a,c,d){b.livequery.findorcreate(this,a,c,d).run();return this},expire:function(a,c,d){(a=b.livequery.find(this,a,c,d))&&a.stop();return this}});b.livequery=function(a,c,d,e){this.selector=c;this.jq=a;this.context=a.context;this.matchedFn=d;this.unmatchedFn=e;this.stopped=!1;this.id=b.livequery.queries.push(this)-1;d.$lqguid=d.$lqguid||b.livequery.guid++;e&&(e.$lqguid=e.$lqguid||b.livequery.guid++)};b.livequery.prototype={run:function(){this.stopped=!1;this.jq.find(this.selector).each(b.proxy(function(a,c){this.added(c)},this))},stop:function(){this.jq.find(this.selector).each(b.proxy(function(a,c){this.removed(c)},this));this.stopped=!0},matches:function(a){return!this.isStopped()&&b(a,this.context).is(this.selector)&&this.jq.has(a).length},added:function(a){this.isStopped()||this.isMatched(a)||(this.markAsMatched(a),this.matchedFn.call(a,a))},removed:function(a){!this.isStopped()&&this.isMatched(a)&&(this.removeMatchedMark(a),this.unmatchedFn&&this.unmatchedFn.call(a,a))},getLQArray:function(a){a=b.data(a,b.livequery.key)||[];var c=b.inArray(this.id,a);a.index=c;return a},markAsMatched:function(a){var c=this.getLQArray(a);-1===c.index&&(c.push(this.id),b.data(a,b.livequery.key,c))},removeMatchedMark:function(a){var c=this.getLQArray(a);-1<c.index&&(c.splice(c.index,1),b.data(a,b.livequery.key,c))},isMatched:function(a){return-1!==this.getLQArray(a).index},isStopped:function(){return!0===this.stopped}};b.extend(b.livequery,{version:"2.0.0-pre",guid:0,queries:[],watchAttributes:!0,attributeFilter:["class","className"],setup:!1,timeout:null,method:"none",prepared:!1,key:"livequery",htcPath:!1,prepare:{mutationobserver:function(){(new MutationObserver(b.livequery.handle.mutationobserver)).observe(document,{childList:!0,attributes:b.livequery.watchAttributes,subtree:!0,attributeFilter:b.livequery.attributeFilter});b.livequery.prepared=!0},mutationevent:function(){document.addEventListener("DOMNodeInserted",b.livequery.handle.mutationevent,!1);document.addEventListener("DOMNodeRemoved",b.livequery.handle.mutationevent,!1);b.livequery.watchAttributes&&document.addEventListener("DOMAttrModified",b.livequery.handle.mutationevent,!1);b.livequery.prepared=!0},iebehaviors:function(){b.livequery.htcPath&&(b("head").append("<style>body *{behavior:url("+b.livequery.htcPath+")}</style>"),b.livequery.prepared=!0)}},handle:{added:function(a){b.each(b.livequery.queries,function(c,b){b.matches(a)&&setTimeout(function(){b.added(a)},1)})},removed:function(a){b.each(b.livequery.queries,function(b,d){d.isMatched(a)&&setTimeout(function(){d.removed(a)},1)})},modified:function(a){b.each(b.livequery.queries,function(b,d){d.isMatched(a)?d.matches(a)||d.removed(a):d.matches(a)&&d.added(a)})},mutationevent:function(a){var c={DOMNodeInserted:"added",DOMNodeRemoved:"removed",DOMAttrModified:"modified"}[a.type];if("modified"===c)-1<b.livequery.attributeFilter.indexOf(a.attrName)&&b.livequery.handle.modified(a.target);else b.livequery.handle[c](a.target)},mutationobserver:function(a){b.each(a,function(a,d){"attributes"===d.type?b.livequery.handle.modified(d.target):b.each(["added","removed"],function(a,c){b.each(d[c+"Nodes"],function(a,d){b.livequery.handle[c](d)})})})}},find:function(a,c,d,e){var g;b.each(b.livequery.queries,function(b,h){if(!(c!==h.selector||a!==h.jq||d&&d.$lqguid!==h.matchedFn.$lqguid||e&&e.$lqguid!==h.unmatchedFn.$lqguid))return(g=h)&&!1});return g},findorcreate:function(a,c,d,e){return b.livequery.find(a,c,d,e)||new b.livequery(a,c,d,e)}});b(function(){"MutationObserver"in window?b.livequery.method="mutationobserver":"MutationEvent"in window?b.livequery.method="mutationevent":"behavior"in document.documentElement.currentStyle&&(b.livequery.method="iebehaviors");if(b.livequery.method)b.livequery.prepare[b.livequery.method]();else throw Error("Could not find a means to monitor the DOM");});b.cookie||(b.cookie=function(a,c,d){if("undefined"!=typeof c){d=d||{};null===c&&(c="",d.expires=-1);var e="";d.expires&&("number"==typeof d.expires||d.expires.toUTCString)&&("number"==typeof d.expires?(e=new Date,e.setTime(e.getTime()+864E5*d.expires)):e=d.expires,e="; expires="+e.toUTCString());var g=d.path?"; path="+d.path:"",h=d.domain?"; domain="+d.domain:"";d=d.secure?"; secure":"";document.cookie=[a,"=",encodeURIComponent(c),e,g,h,d].join("")}else{c=null;if(document.cookie&&""!=document.cookie)for(d=document.cookie.split(";"),e=0;e<d.length;e++)if(g=b.trim(d[e]),g.substring(0,a.length+1)==a+"="){c=decodeURIComponent(g.substring(a.length+1));break}return c}});(function(a){function b(){}function d(a){D=[a]}function e(a,b,c){return a&&a.apply(b.context||b,c)}function g(f){function g(a){w++||(x(),y&&(n[l]={s:[a]}),J&&(a=J.apply(f,[a])),e(F,f,[a,"success",f]),e(K,f,[f,"success"]))}function E(a){w++||(x(),y&&"timeout"!=a&&(n[l]=a),e(G,f,[f,a]),e(K,f,[f,a]))}f=a.extend({},q,f);var F=f.success,G=f.error,K=f.complete,J=f.dataFilter,z=f.callbackParameter,L=f.callback,C=f.cache,y=f.pageCache,M=f.charset,l=f.url,p=f.data,N=f.timeout,A,w=0,x=b,k,t,H;m&&m(function(a){a.done(F).fail(G);F=a.resolve;G=a.reject}).promise(f);f.abort=function(){!w++&&x()};if(!1===e(f.beforeSend,f,[f])||w)return f;l=l||"";p=p?"string"==typeof p?p:a.param(p,f.traditional):"";l+=p?(/\?/.test(l)?"&":"?")+p:"";z&&(l+=(/\?/.test(l)?"&":"?")+encodeURIComponent(z)+"=?");C||y||(l+=(/\?/.test(l)?"&":"?")+"_"+(new Date).getTime()+"=");l=l.replace(/=\?(&|$)/,"="+L+"$1");y&&(A=n[l])?A.s?g(A.s[0]):E(A):(h[L]=d,k=a("<script>")[0],k.id="_jqjsp"+v++,M&&(k.charset=M),u&&11.6>u.version()?(t=a("<script>")[0]).text="document.getElementById('"+k.id+"').onerror()":k.async="async",B&&(k.htmlFor=k.id,k.event="onclick"),k.onload=k.onerror=k.onreadystatechange=function(a){if(!k.readyState||!/i/.test(k.readyState)){try{k.onclick&&k.onclick()}catch(b){}a=D;D=0;a?g(a[0]):E("error")}},k.src=l,x=function(a){H&&clearTimeout(H);k.onreadystatechange=k.onload=k.onerror=null;r.removeChild(k);t&&r.removeChild(t)},r.insertBefore(k,z=r.firstChild),t&&r.insertBefore(t,z),H=0<N&&setTimeout(function(){E("timeout")},N));return f}var h=window,m=a.Deferred,r=a("head")[0]||document.documentElement,n={},v=0,D,q={callback:"_jqjsp",url:location.href},u=h.opera,B=!!a("<div>").html("\x3c!--[if IE]><i><![endif]--\x3e").find("i").length;g.setup=function(b){a.extend(q,b)};a.jsonp=g})(b)}var u=["//jsonip.appspot.com/?callback=?","http://ip-api.com/json?callback=?","http://www.telize.com/geoip?callback=?"],R=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/,S=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){5}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/,T=/xmlshop=1/.test(document.location.search),U={access:"AKIAJNSCAITHJ6IIDREA",secret:"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",region:"us-east-1",partition:"1",stream:"forbes_data"},B=function(a){AWS.config.update({accessKeyId:a.access,secretAccessKey:a.secret});this.staticData=a.staticData;this.stream={PartitionKey:a.partition,StreamName:a.stream};this.kinesis=new AWS.Kinesis({region:a.region})};B.prototype.put=function(a){a=b.extend(!0,{},a||{},this.staticData,{ts:+(new Date/1E3).toFixed(),additionalInfo:{viewportSize:Math.max(document.documentElement.clientWidth,window.innerWidth||0)+"x"+Math.max(document.documentElement.clientHeight,window.innerHeight||0)}});a.additionalInfo=JSON.stringify(a.additionalInfo);this.kinesis.putRecord(b.extend({Data:AWS.util.base64.encode(JSON.stringify(a))},this.stream),function(a,b){T&&(a?console.log(a,a.stack):console.log(b))})};var m=function(a,c){this.article=b(a);this.stats=c;this.startTime=+new Date;this.boxes={articleBody:b(".article_body .body",this.article),commentsBody:b(".comments_collection",this.article)};this.url=document.location.protocol+"//"+document.location.hostname+this.article.data("uri");this.articleReadPercent=0;this.dimentions={comments:{},article:{}};this.updateDimentions();this.addHandlers();c.baseArticleInited?this.loadedArticle():c.baseArticleInited=!0};m.prototype.addHandlers=function(){this.boxes.articleBody.bind("mouseup",b.proxy(this.selectedText,this));this.stats.wrappers.document.bind("scroll",b.proxy(function(){this.updateDimentions();this.readArticle();this.readComments()},this))};m.prototype.updateDimentions=function(){var a;a=this.boxes.articleBody.offset();this.dimentions.article={top:a.top,left:a.left,width:this.boxes.articleBody.width(),height:this.boxes.articleBody.height()};a=this.boxes.commentsBody.offset();this.dimentions.comments={top:a.top,left:a.left,width:this.boxes.commentsBody.width(),height:this.boxes.commentsBody.height()}};m.prototype.readArticle=function(){if(!this.articleReadDone){this.articleTimer&&clearTimeout(this.articleTimer);var a=this.stats.wrappers.window.scrollTop();a+this.stats.viewport.height/2>this.dimentions.article.top&&a<this.dimentions.article.top+this.dimentions.article.height-this.stats.viewport.height/2&&(this.articleTimer=window.setTimeout(b.proxy(function(){this.articleReadProgress(a)},this),1E3))}};m.prototype.articleReadProgress=function(a){a=(a+this.stats.viewport.height-this.dimentions.article.top)/this.dimentions.article.height*100;this.articleReadPercent>=a||100==this.articleReadPercent||(this.articleReadPercent=100<a?100:a,this.stats.kinesis.put({eventCode:1,eventName:"Post reading",url:this.url,additionalInfo:{"Time on article":this.timeOnArticle(),"Time on page":this.stats.getTimeOnPage(),"Percentage of reading":+this.articleReadPercent.toFixed(0),"Base url":this.stats.url}}))};m.prototype.readComments=function(){this.commentsTimer&&clearTimeout(this.commentsTimer);var a=this.stats.wrappers.window.scrollTop();a+this.stats.viewport.height/2>this.dimentions.comments.top&&a<this.dimentions.comments.top+this.dimentions.comments.height-this.stats.viewport.height/2?this.commentsInRead||(this.commentsTimer=window.setTimeout(b.proxy(this.commentsReadStart,this),1E3)):this.commentsInRead=null};m.prototype.commentsReadStart=function(){this.commentsInRead=!0;this.stats.kinesis.put({eventCode:4,eventName:"Reads the comments",url:this.url,additionalInfo:{"Time on article":this.timeOnArticle(),"Time on page":this.getTimeOnPage(),"Base url":this.stats.url,"Percentage of reading":+this.articleReadPercent.toFixed(0)}})};m.prototype.timeOnArticle=function(){return+((+new Date-this.startTime)/1E3).toFixed()};m.prototype.loadedArticle=function(){this.stats.kinesis.put({eventCode:10,eventName:"Load new article",url:this.url,additionalInfo:{"Time on page":this.stats.getTimeOnPage(),"Base url":this.stats.url}})};m.prototype.selectedText=function(){var a;window.getSelection?a=window.getSelection():document.selection&&(a=document.selection.createRange());a=b.trim(a.toString().replace("&nbsp"," ").replace(/[\r\n\t]/ig," ").replace(/\s{2,}/g," "));""!=a&&this.stats.kinesis.put({eventCode:7,eventName:"Text selection",url:this.url,additionalInfo:{"Time on article":this.timeOnArticle(),"Time on page":this.stats.getTimeOnPage(),"Selected text":a}})};var h=function(a){var c=this;b.extend(this,{ua:navigator.userAgent},a);this.wrappers={body:b("body"),window:b(window),document:b(document)};this.baseArticleInited=!1;this.url=document.location.href.split("#")[0];this.kinesis=new B(b.extend({},U,{staticData:{uid:this.uid,ua:this.ua,user_ip:this.user_ip,additionalInfo:{screenSize:window.screen.width+"x"+window.screen.height}}}));this.startTime=+new Date;this.mouse={x:0,y:0,run:0};this.scroll={top:0,left:0,run:0};this.viewport={};this.updateDimentions();this.wrappers.body.livequery(".article_container",function(){new m(this,c)});this.addHandlers()};h.prototype.getTimeOnPage=function(){return+((+new Date-this.startTime)/1E3).toFixed()};h.prototype.addHandlers=function(){this.wrappers.window.bind("beforeunload",b.proxy(this.unloadHadler,this));this.wrappers.document.bind("mousemove",b.proxy(this.mouseRun,this)).bind("scroll",b.proxy(this.updateDimentions,this)).bind("scroll",b.proxy(this.scrollRun,this)).bind("mousemove mousedown keydown scroll",b.proxy(this.awayCounter,this))};h.prototype.updateDimentions=function(){this.viewport={height:this.wrappers.window.innerHeight(),width:this.wrappers.window.innerWidth()}};h.prototype.mouseRun=function(a){var b=a.pageX;a=a.pageY;this.mouse.run+=Math.sqrt(Math.pow(Math.abs(this.mouse.x-b),2)+Math.pow(Math.abs(this.mouse.y-a),2));this.mouse.x=b;this.mouse.y=a};h.prototype.scrollRun=function(){var a=this.wrappers.window.scrollTop();this.scroll.run+=Math.abs(this.scroll.top-a);this.scroll.top=a};h.prototype.awayCounter=function(){this.awayTimer&&clearTimeout(this.awayTimer);this.awayTimer=setTimeout(b.proxy(this.userAway,this),6E4)};h.prototype.userAway=function(){this.kinesis.put({eventCode:11,eventName:"Probably left",url:document.location.href.split("#")[0],additionalInfo:{"Time on page":this.getTimeOnPage(),"Base url":this.url}})};h.prototype.unloadHadler=function(){this.kinesis.put({eventCode:12,eventName:"Page leave",url:document.location.href.split("#")[0],additionalInfo:{"Total time":this.getTimeOnPage(),"Mouse run":+this.mouse.run.toFixed(),"Scroll run":+this.scroll.run.toFixed(),"Base url":this.url}})};"undefined"==typeof b?function(){function a(){document.addEventListener?(document.removeEventListener("DOMContentLoaded",b,!1),window.removeEventListener("load",b,!1)):(document.detachEvent("onreadystatechange",b),window.detachEvent("onload",b))}function b(){if(document.addEventListener||"load"===event.type||"complete"===document.readyState)a(),d()}var d=function(){d.isReady=!0;v()};d.isReady=!1;if("complete"===document.readyState)setTimeout(d);else if(document.addEventListener)document.addEventListener("DOMContentLoaded",b,!1),window.addEventListener("load",b,!1);else{document.attachEvent("onreadystatechange",b);window.attachEvent("onload",b);var e=!1;try{e=null==window.frameElement&&document.documentElement}catch(g){}e&&e.doScroll&&function Q(){if(!d.isReady){try{e.doScroll("left")}catch(b){return setTimeout(Q,50)}a();d()}}()}}():v();var P=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}(),n=function(){var a=b.Deferred(),c=a.promise(),d=C(0,u.length-1);(d=u.splice(d,1)[0])?b.jsonp({url:d}).done(function(b){b=b.ip||b.query||"";R.test(b)||S.test(b)?a.resolve(b):n().done(function(b){a.resolve(b)}).fail(function(){a.reject()})}).fail(function(){n().done(function(b){a.resolve(b)}).fail(function(){a.reject()})}):a.reject();return c}}(window.jQuery));